<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>로그인</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
        }
        .login-container {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            padding: 12px 40px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        .login-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            font-size: 2rem;
        }
        .input-group-text {
            background: transparent;
            border-right: none;
        }
        .form-control {
            border-left: none;
            padding-left: 0;
        }
        .form-control:focus + .input-group-text,
        .input-group-text:focus-within {
            border-color: #667eea;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="login-container p-5">
                <!-- 로그인 아이콘 -->
                <div class="login-icon">
                    <i class="bi bi-person-fill"></i>
                </div>

                <!-- 제목 -->
                <h2 class="text-center mb-4 fw-bold text-dark">로그인</h2>
                <p class="text-center text-muted mb-4">계정에 로그인하세요</p>

                <!-- 로그인 폼 -->
                <form id="loginForm">
                    <div class="mb-4">
                        <label for="userId" class="form-label fw-semibold">
                            <i class="bi bi-person me-2"></i>아이디
                        </label>
                        <div class="input-group">
                                <span class="input-group-text">
                                    <i class="bi bi-person"></i>
                                </span>
                            <input type="text"
                                   class="form-control form-control-lg"
                                   id="userId"
                                   name="userId"
                                   placeholder="아이디를 입력하세요"
                                   required>
                        </div>
                    </div>

                    <div class="d-grid mb-4">
                        <button type="submit" class="btn btn-primary btn-lg btn-login">
                            <i class="bi bi-box-arrow-in-right me-2"></i>
                            로그인
                        </button>
                    </div>
                </form>

                <!-- 메시지 표시 영역 -->
                <div id="messageContainer" style="display: none;">
                    <div id="alertBox" class="alert" role="alert">
                        <i id="alertIcon" class="me-2"></i>
                        <span id="message"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // 메시지 표시 함수
    function showMessage(message, type = 'success') {
        const messageContainer = document.getElementById('messageContainer');
        const alertBox = document.getElementById('alertBox');
        const alertIcon = document.getElementById('alertIcon');
        const messageElement = document.getElementById('message');

        // 메시지와 아이콘 설정
        messageElement.textContent = message;

        if (type === 'success') {
            alertBox.className = 'alert alert-success d-flex align-items-center';
            alertIcon.className = 'bi bi-check-circle-fill me-2';
        } else {
            alertBox.className = 'alert alert-danger d-flex align-items-center';
            alertIcon.className = 'bi bi-exclamation-triangle-fill me-2';
        }

        // 메시지 표시
        messageContainer.style.display = 'block';

        // 3초 후 자동 숨김
        setTimeout(() => {
            messageContainer.style.display = 'none';
        }, 3000);
    }

    // 로딩 상태 관리
    function setLoading(isLoading) {
        const submitBtn = document.querySelector('button[type="submit"]');
        const userId = document.getElementById('userId');

        if (isLoading) {
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>로그인 중...';
            submitBtn.disabled = true;
            userId.disabled = true;
        } else {
            submitBtn.innerHTML = '<i class="bi bi-box-arrow-in-right me-2"></i>로그인';
            submitBtn.disabled = false;
            userId.disabled = false;
        }
    }

    // 폼 제출 이벤트
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const userId = document.getElementById("userId").value.trim();

        // 입력값 검증
        if (!userId) {
            showMessage("아이디를 입력해주세요.", "error");
            return;
        }

        console.log('userId : ' + userId);
        setLoading(true);

        try {
            const response = await fetch("/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    userId: userId
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.message || "로그인에 실패했습니다.");
            }

            const data = await response.json();

            // 토큰 저장
            localStorage.setItem("accessToken", data.accessToken);
            localStorage.setItem("refreshToken", data.refreshToken);

            showMessage("로그인 성공! 잠시 후 페이지가 이동됩니다.", "success");

            // 2초 후 메인 페이지로 이동
            setTimeout(() => {
                window.location.href = "/";
            }, 2000);

        } catch (error) {
            console.error('Login error:', error);
            showMessage(error.message, "error");
        } finally {
            setLoading(false);
        }
    });

    // 엔터키 지원
    document.getElementById("userId").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
            document.getElementById("loginForm").dispatchEvent(new Event("submit"));
        }
    });

    // 페이지 로드 시 포커스
    window.addEventListener("load", () => {
        document.getElementById("userId").focus();
    });
</script>
</body>
</html>